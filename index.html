<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Akƒ±l Zeka Oyunlarƒ± - Pro Arena</title>
    
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, update, onDisconnect, get, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyByVamD_83D1gNH9wMiR0jtQErasgq7Gss",
            authDomain: "turnuva-2418e.firebaseapp.com",
            databaseURL: "https://turnuva-2418e-default-rtdb.europe-west1.firebasedatabase.app/",
            projectId: "turnuva-2418e",
            storageBucket: "turnuva-2418e.firebasestorage.app",
            messagingSenderId: "299388405608",
            appId: "1:299388405608:web:e0985927f084bf803678dd"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        window.db = db; window.dbRef = ref; window.dbSet = set; window.dbOnValue = onValue; window.dbUpdate = update; window.dbOnDisconnect = onDisconnect; window.dbGet = get; window.dbRemove = remove;
    </script>

    <style>
        /* --- CORE RESET & LAYOUT --- */
        html, body {
            width: 100%; height: 100%; margin: 0; padding: 0;
            overflow: hidden; 
            background-color: #020617; 
            color: white;
            font-family: 'Rajdhani', sans-serif;
            touch-action: none; /* Mobilde kaydƒ±rmayƒ± engeller */
            -webkit-user-select: none; user-select: none;
        }

        /* --- BACKGROUND & FX --- */
        .app-bg {
            position: fixed; inset: 0; z-index: -1;
            background: radial-gradient(circle at 50% 0%, #172554 0%, #020617 80%);
        }
        .grid-overlay {
            position: absolute; inset: 0;
            background-image: linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
            linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 30px 30px;
            opacity: 0.5;
        }

        /* --- GLASS PANELS --- */
        .glass-box {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.5);
        }
        
        /* --- GAME ELEMENTS --- */
        .pit {
            position: relative;
            background: rgba(2, 6, 23, 0.5);
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.8), 0 1px 0 rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.05);
            transition: all 0.2s;
        }
        .pit:active { transform: scale(0.95); background: rgba(2, 6, 23, 0.8); }
        .pit-active {
            border-color: #3b82f6;
            box-shadow: inset 0 0 15px rgba(59, 130, 246, 0.2), 0 0 10px rgba(59, 130, 246, 0.4);
        }

        .marble {
            position: absolute; border-radius: 50%;
            box-shadow: inset -1px -1px 2px rgba(0,0,0,0.8), inset 1px 1px 2px rgba(255,255,255,0.8), 0 2px 4px rgba(0,0,0,0.5);
        }

        /* --- RESPONSIVE HELPERS --- */
        /* PC Mode (Default Large) */
        .game-wrapper {
            width: 100%; height: 100%;
            display: flex; flex-direction: column;
        }
        @media (min-width: 1024px) {
            .pc-container {
                max-width: 1100px;
                height: 85vh;
                margin: auto;
                border-radius: 24px;
                overflow: hidden;
                border: 1px solid rgba(255,255,255,0.1);
                box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
            }
        }

        /* Animations */
        @keyframes pop { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .anim-pop { animation: pop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
    </style>
</head>
<body>
    <div class="app-bg"><div class="grid-overlay"></div></div>
    <div id="root" class="w-full h-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const BADGES = { first_win: {icon:"‚≠ê",name:"ƒ∞lk Zafer"}, mangala_master: {icon:"ü¶Å",name:"Mangala Kurdu"}, reversi_brain: {icon:"üß†",name:"Strateji Dehasƒ±"}, streak_fire: {icon:"üî•",name:"Yenilmez"} };

        // --- GAME LOGIC (UNCHANGED) ---
        function useMangalaGame(gameData, gameId, playerRole, onWin) {
            const moveStone = (pitIndex) => {
                if (gameData.winner) return;
                const isP1Turn = gameData.isP1Turn;
                const board = (gameData.board || []).map(n => parseInt(n, 10) || 0);

                if ((playerRole === 'P1' && !isP1Turn) || (playerRole === 'P2' && isP1Turn)) return;
                if (isP1Turn && (pitIndex < 0 || pitIndex > 5)) return;
                if (!isP1Turn && (pitIndex < 7 || pitIndex > 12)) return;
                if (board[pitIndex] === 0) return;

                let stones = board[pitIndex];
                let currentIndex = pitIndex;
                board[pitIndex] = 0; 

                if (stones === 1) {
                    currentIndex = (currentIndex + 1) % 14;
                    board[currentIndex] += 1;
                } else {
                    board[currentIndex] = 1; stones--; 
                    while (stones > 0) {
                        currentIndex = (currentIndex + 1) % 14;
                        if (isP1Turn && currentIndex === 13) continue;
                        if (!isP1Turn && currentIndex === 6) continue;
                        board[currentIndex] += 1; stones--;
                    }
                }
                const lastIndex = currentIndex;
                const p1Store = 6; const p2Store = 13;
                const isMyStore = isP1Turn ? lastIndex === p1Store : lastIndex === p2Store;
                const isOpponentSide = isP1Turn ? (lastIndex >= 7 && lastIndex <= 12) : (lastIndex >= 0 && lastIndex <= 5);
                const isMySide = isP1Turn ? (lastIndex >= 0 && lastIndex <= 5) : (lastIndex >= 7 && lastIndex <= 12);
                let nextTurnIsP1 = !isP1Turn;
                if (isMyStore) { nextTurnIsP1 = isP1Turn; }
                else if (isOpponentSide && board[lastIndex] % 2 === 0) {
                    const myStoreIndex = isP1Turn ? p1Store : p2Store;
                    board[myStoreIndex] += board[lastIndex]; board[lastIndex] = 0;
                }
                else if (isMySide && board[lastIndex] === 1) { 
                    const oppositeIndex = 12 - lastIndex;
                    if (board[oppositeIndex] > 0) {
                        const myStoreIndex = isP1Turn ? p1Store : p2Store;
                        board[myStoreIndex] += (board[lastIndex] + board[oppositeIndex]);
                        board[lastIndex] = 0; board[oppositeIndex] = 0;
                    }
                }
                const p1PitSum = board.slice(0, 6).reduce((a, b) => a + b, 0);
                const p2PitSum = board.slice(7, 13).reduce((a, b) => a + b, 0);
                let w = null;
                if (p1PitSum === 0 || p2PitSum === 0) {
                    if (p1PitSum === 0) { board[p1Store] += p2PitSum; for(let i=7; i<=12; i++) board[i] = 0; } 
                    else { board[p2Store] += p1PitSum; for(let i=0; i<=5; i++) board[i] = 0; }
                    if (board[p1Store] > board[p2Store]) w = gameData.players.p1.name;
                    else if (board[p2Store] > board[p1Store]) w = gameData.players.p2.name;
                    else w = "Berabere";
                    if(w && w !== "Berabere") { const wRole = w === gameData.players.p1.name ? 'P1' : 'P2'; if(wRole === playerRole) onWin('mangala'); }
                }
                window.dbUpdate(window.dbRef(window.db, 'games/' + gameId), { board: board, isP1Turn: nextTurnIsP1, winner: w });
            };
            return { moveStone };
        }

        function useReversiGame(gameData, gameId, playerRole, onWin) {
            const makeMove = (row, col) => {
                if (gameData.winner) return;
                const isP1Turn = gameData.isP1Turn; if ((playerRole === 'P1' && !isP1Turn) || (playerRole === 'P2' && isP1Turn)) return;
                const myColor = isP1Turn ? 1 : 2; const oppColor = isP1Turn ? 2 : 1; const board = gameData.board;
                if (board[row * 8 + col] !== 0) return;
                let flips = [];
                const directions = [[0,1], [1,0], [0,-1], [-1,0], [1,1], [1,-1], [-1,1], [-1,-1]];
                directions.forEach(([dr, dc]) => { let r = row + dr, c = col + dc; let potential = []; while (r>=0 && r<8 && c>=0 && c<8 && board[r*8+c] === oppColor) { potential.push(r*8+c); r += dr; c += dc; } if (potential.length > 0 && r>=0 && r<8 && c>=0 && c<8 && board[r*8+c] === myColor) flips.push(...potential); });
                if (flips.length === 0) return;
                let newBoard = [...board]; newBoard[row * 8 + col] = myColor;
                flips.forEach(idx => newBoard[idx] = myColor);
                let w = null; if (!newBoard.includes(0)) { const p1c = newBoard.filter(x => x === 1).length;
                const p2c = newBoard.filter(x => x === 2).length; w = p1c > p2c ?
                gameData.players.p1.name : (p2c > p1c ? gameData.players.p2.name : "Berabere"); if(w && w !== "Berabere") { const wRole = w === gameData.players.p1.name ?
                'P1' : 'P2'; if(wRole === playerRole) onWin('reversi'); } }
                window.dbUpdate(window.dbRef(window.db, 'games/' + gameId), { board: newBoard, isP1Turn: !isP1Turn, winner: w });
            };
            return { makeMove };
        }

        // --- RESPONSIVE GAME COMPONENTS ---
        const MangalaBoard = ({ game, playerRole, onMove }) => {
            const board = (game.board || []).map(n => parseInt(n, 10) || 0);
            const isMyTurn = (playerRole === 'P1' && game.isP1Turn) || (playerRole === 'P2' && !game.isP1Turn);

            const Pit = ({ c, owner, store, act, active }) => {
                const count = Math.max(0, c || 0);
                const marbles = [...Array(Math.min(count, 15))].map((_, i) => {
                    const angle = i * (360 / Math.min(count, 8));
                    const dist = Math.min(i * 2, 10);
                    const x = Math.cos(angle * Math.PI / 180) * dist;
                    const y = Math.sin(angle * Math.PI / 180) * dist;
                    const color = owner==='me' ? 'bg-amber-400' : 'bg-cyan-400';
                    return <div key={i} className={`w-2.5 h-2.5 sm:w-3 sm:h-3 marble ${color}`} style={{transform: `translate(${x}px, ${y}px)`}}></div>
                });

                return (
                    <div onClick={act} className={`relative flex items-center justify-center rounded-2xl pit overflow-hidden
                        ${store ? 'w-full h-full' : 'w-full aspect-square'}
                        ${active ? 'pit-active' : 'opacity-75'}
                    `}>
                        <div className="flex items-center justify-center w-full h-full relative">{marbles}</div>
                        <div className={`absolute bottom-0 right-0 px-1.5 py-0.5 text-[10px] sm:text-xs font-bold bg-slate-900/80 text-white rounded-tl-lg border-l border-t border-slate-700`}>{count}</div>
                    </div>
                );
            };

            return (
                <div className="w-full h-full p-2 sm:p-6 flex flex-col md:flex-row gap-4 items-center justify-center bg-slate-900/50 backdrop-blur-sm relative">
                    
                    {/* RAKƒ∞P ALANI (MOBƒ∞LDE √úSTTE, PCDE SOLDA) */}
                    <div className="flex flex-row md:flex-col items-center gap-2 w-full md:w-24 h-24 md:h-full justify-center">
                        <div className="text-[10px] font-bold text-slate-500 tracking-wider bg-slate-950 px-2 py-1 rounded">RAKƒ∞P</div>
                        <div className="h-full w-24 md:w-full md:h-48 rounded-2xl overflow-hidden border border-slate-700 bg-slate-950/50">
                            <Pit c={playerRole==='P1'?board[13]:board[6]} owner="opponent" store={true} />
                        </div>
                    </div>

                    {/* OYUN ALANI (ORTA) */}
                    <div className="flex-1 w-full max-w-2xl flex flex-col gap-4">
                        {/* Rakip Sƒ±rasƒ± */}
                        <div className="grid grid-cols-6 gap-2 sm:gap-4 p-3 bg-slate-950/30 rounded-2xl border border-slate-800">
                             {[0,1,2,3,4,5].map(i => { const idx = playerRole==='P1' ? (12-i) : (5-i); return <Pit key={idx} c={board[idx]} owner="opponent"/> })}
                        </div>
                        {/* Benim Sƒ±ram */}
                        <div className={`grid grid-cols-6 gap-2 sm:gap-4 p-3 rounded-2xl border transition-colors ${isMyTurn ? 'bg-blue-900/10 border-blue-500/30' : 'bg-slate-950/30 border-slate-800'}`}>
                             {[0,1,2,3,4,5].map(i => { const idx = playerRole==='P1' ? i : (i+7); return <Pit key={idx} c={board[idx]} owner="me" active={isMyTurn} act={()=>isMyTurn && onMove(idx)}/> })}
                        </div>
                    </div>

                    {/* BENƒ∞M ALANIM (MOBƒ∞LDE ALTTA, PCDE SAƒûDA) */}
                    <div className="flex flex-row md:flex-col items-center gap-2 w-full md:w-24 h-24 md:h-full justify-center">
                        <div className="text-[10px] font-bold text-amber-500 tracking-wider bg-slate-950 px-2 py-1 rounded">SEN</div>
                        <div className="h-full w-24 md:w-full md:h-48 rounded-2xl overflow-hidden border border-amber-900/30 bg-slate-950/50">
                            <Pit c={playerRole==='P1'?board[6]:board[13]} owner="me" store={true} />
                        </div>
                    </div>
                </div>
            );
        };

        const ReversiBoard = ({ game, playerRole, onMove }) => {
            const board = (game.board || []).map(n => parseInt(n, 10) || 0);
            const isMyTurn = (playerRole === 'P1' && game.isP1Turn) || (playerRole === 'P2' && !game.isP1Turn); 
            const black = board.filter(x=>x===1).length; const white = board.filter(x=>x===2).length;
            
            return (
                <div className="flex flex-col md:flex-row gap-6 items-center justify-center w-full h-full p-4 overflow-y-auto">
                    <div className="flex flex-row md:flex-col gap-4 w-full md:w-auto justify-center">
                        <div className="glass-box p-3 rounded-xl flex items-center justify-between gap-4 w-32"><div className="w-6 h-6 bg-black rounded-full border border-gray-600"></div><span className="text-2xl font-bold">{black}</span></div>
                        <div className="glass-box p-3 rounded-xl flex items-center justify-between gap-4 w-32 bg-slate-200 text-black"><div className="w-6 h-6 bg-white rounded-full border border-gray-300"></div><span className="text-2xl font-bold">{white}</span></div>
                    </div>
                    <div className="bg-green-800 p-2 rounded-lg shadow-2xl border-4 border-green-900 w-full max-w-[400px] aspect-square">
                        <div className="grid grid-cols-8 gap-1 h-full">
                            {board.map((cell, i) => (
                                <div key={i} onClick={() => isMyTurn && onMove(Math.floor(i/8), i%8)} className="bg-green-600 hover:bg-green-500 cursor-pointer flex items-center justify-center rounded-sm">
                                    {cell !== 0 && <div className={`w-[80%] h-[80%] rounded-full shadow-md transition-transform duration-300 hover:scale-105 ${cell===1?'bg-black border border-gray-700':'bg-white border border-gray-300'}`}></div>}
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const ProfileModal = ({ user, onClose, onLogout }) => (
            <div className="fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4" onClick={onClose}>
                <div className="glass-box w-full max-w-sm rounded-2xl overflow-hidden anim-pop shadow-2xl" onClick={e=>e.stopPropagation()}>
                    <div className="p-6 text-center border-b border-white/10 relative">
                        <button onClick={onClose} className="absolute top-4 right-4 text-slate-400 hover:text-white"><i className="fas fa-times"></i></button>
                        <div className="w-20 h-20 mx-auto bg-gradient-to-tr from-blue-600 to-indigo-600 rounded-full flex items-center justify-center text-3xl font-bold mb-3 shadow-lg">{user.name.charAt(0)}</div>
                        <h2 className="text-xl font-bold text-white">{user.name}</h2>
                        <p className="text-slate-400 text-sm">{user.schoolName}</p>
                    </div>
                    <div className="p-4 grid grid-cols-2 gap-3 text-center">
                        <div className="bg-slate-950/50 p-2 rounded-xl border border-white/5"><div className="text-xl font-bold text-blue-400">{user.stats?.wins||0}</div><div className="text-[10px] text-slate-500">ZAFER</div></div>
                        <div className="bg-slate-950/50 p-2 rounded-xl border border-white/5"><div className="text-xl font-bold text-amber-400">{(user.badges||[]).length}</div><div className="text-[10px] text-slate-500">ROZET</div></div>
                    </div>
                    <div className="p-4 bg-slate-950/30 max-h-[200px] overflow-y-auto">
                        <h3 className="text-[10px] font-bold text-slate-500 mb-2 tracking-wider">ROZETLERƒ∞M</h3>
                        {user.badges && user.badges.length > 0 ? (
                            <div className="grid grid-cols-1 gap-2">
                                {user.badges.map(b => (
                                    <div key={b} className="flex items-center gap-3 p-2 rounded bg-slate-800/50 border border-white/5">
                                        <div className="text-lg">{BADGES[b]?.icon}</div>
                                        <div className="text-left text-xs font-bold text-slate-300">{BADGES[b]?.name}</div>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <div className="text-center text-slate-600 text-xs py-4">Hen√ºz rozet kazanƒ±lmadƒ±.</div>
                        )}
                    </div>
                    <button onClick={onLogout} className="w-full py-4 bg-red-900/20 text-red-400 text-xs font-bold hover:bg-red-900/30 transition-colors border-t border-white/5">√áIKI≈û YAP</button>
                </div>
            </div>
        );

        const AuthScreen = ({ onLogin, onRegister }) => {
            const [mode, setMode] = useState("login");
            const [schools, setSchools] = useState([]); const [schoolId, setSchoolId] = useState(""); const [number, setNumber] = useState(""); const [password, setPassword] = useState(""); const [name, setName] = useState(""); const [cls, setCls] = useState("");
            useEffect(() => { if(window.dbRef) window.dbOnValue(window.dbRef(window.db, 'schools'), (snap) => { const val = snap.val(); if(val) setSchools(Object.values(val)); }); }, []);
            const doAuth = () => { if(!schoolId || !number || !password) return alert("Eksik bilgi!"); if(mode === "login") onLogin(schoolId, number, password); else { if(!name || !cls) return alert("Ad ve Sƒ±nƒ±f giriniz!"); const selectedSchool = schools.find(s => s.id === schoolId); onRegister({ schoolId, schoolName: selectedSchool.name, number, password, name, class: cls }); } };
            
            return (
                <div className="w-full h-full flex items-center justify-center p-4">
                    <div className="glass-box w-full max-w-sm rounded-2xl p-8 anim-pop">
                        <div className="text-center mb-6">
                            <h1 className="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-indigo-400 tracking-wider">ARENA</h1>
                            <p className="text-slate-500 text-[10px] tracking-[0.2em] uppercase">Akƒ±l Zeka Oyunlarƒ±</p>
                        </div>
                        <div className="space-y-3">
                            <div className="bg-slate-950/50 p-2 rounded border border-white/5">
                                <label className="text-[10px] text-blue-500 font-bold block mb-1">OKUL</label>
                                <select value={schoolId} onChange={e=>setSchoolId(e.target.value)} className="w-full bg-transparent text-sm outline-none font-bold"><option value="">Se√ßiniz</option>{schools.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}</select>
                            </div>
                            {mode==="register" && <div className="grid grid-cols-2 gap-2"><input placeholder="Ad Soyad" value={name} onChange={e=>setName(e.target.value)} className="bg-slate-950/50 p-3 rounded border border-white/5 text-sm outline-none" /><input placeholder="Sƒ±nƒ±f" value={cls} onChange={e=>setCls(e.target.value)} className="bg-slate-950/50 p-3 rounded border border-white/5 text-sm outline-none" /></div>}
                            <div className="grid grid-cols-2 gap-2"><input placeholder="Numara" value={number} onChange={e=>setNumber(e.target.value)} className="bg-slate-950/50 p-3 rounded border border-white/5 text-sm text-center outline-none" /><input type="password" placeholder="≈ûifre" value={password} onChange={e=>setPassword(e.target.value)} className="bg-slate-950/50 p-3 rounded border border-white/5 text-sm text-center outline-none" /></div>
                            <button onClick={doAuth} className="w-full py-3 bg-blue-600 hover:bg-blue-500 rounded font-bold text-sm shadow-lg shadow-blue-900/50 transition-all">{mode==="login"?"Gƒ∞Rƒ∞≈û":"KAYIT OL"}</button>
                            <button onClick={()=>setMode(mode==="login"?"register":"login")} className="w-full text-xs text-slate-500 hover:text-white transition mt-2">{mode==="login"?"Hesap Olu≈ütur":"Giri≈üe D√∂n"}</button>
                        </div>
                    </div>
                </div>
            );
        };

        const GameShell = ({ gameId, playerRole, onBack, onWin }) => {
            const [gameData, setGameData] = useState(null);
            useEffect(() => { const sub = window.dbOnValue(window.dbRef(window.db, 'games/' + gameId), (s) => setGameData(s.val())); return () => sub(); }, [gameId]);
            if (!gameData) return <div className="w-full h-full flex items-center justify-center"><i className="fas fa-circle-notch fa-spin text-4xl text-blue-500"></i></div>;
            
            return (
                <div className="w-full h-full flex flex-col pc-container bg-slate-950/80 backdrop-blur-xl relative">
                    {/* HEADER */}
                    <div className="h-14 flex items-center justify-between px-4 border-b border-white/10 bg-slate-950/50 shrink-0">
                        <div className="text-xs font-bold text-slate-500 border border-slate-700 px-2 py-1 rounded">#{gameId}</div>
                        {gameData.winner ? 
                             <div className="px-3 py-1 bg-amber-500/10 text-amber-500 border border-amber-500/20 rounded text-xs font-bold animate-pulse">üèÜ {gameData.winner}</div>
                            : <div className={`px-3 py-1 rounded text-xs font-bold border ${((playerRole==='P1' && gameData.isP1Turn)||(playerRole==='P2' && !gameData.isP1Turn)) ? 'bg-green-500/10 text-green-400 border-green-500/20' : 'bg-slate-800 text-slate-500 border-slate-700'}`}>
                                {((playerRole==='P1' && gameData.isP1Turn)||(playerRole==='P2' && !gameData.isP1Turn)) ? "HAMLE SIRASI" : "BEKLENƒ∞YOR"}
                            </div>
                        }
                        <button onClick={onBack} className="w-8 h-8 flex items-center justify-center bg-red-500/10 text-red-500 rounded hover:bg-red-500 hover:text-white transition"><i className="fas fa-times"></i></button>
                    </div>
                    {/* GAME AREA */}
                    <div className="flex-1 overflow-hidden relative">
                         {gameData.type === 'reversi' ? 
                            <ReversiBoard game={gameData} playerRole={playerRole} onMove={useReversiGame(gameData, gameId, playerRole, onWin).makeMove} /> : 
                            <MangalaBoard game={gameData} playerRole={playerRole} onMove={useMangalaGame(gameData, gameId, playerRole, onWin).moveStone} />
                        }
                    </div>
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null); const [status, setStatus] = useState("loading"); const [gameId, setGameId] = useState(null); const [role, setRole] = useState(null); const [prof, setProf] = useState(false); const [badge, setBadge] = useState(null);
            useEffect(() => { const uid = localStorage.getItem("az_uid"); if(uid) check(uid); else setStatus("auth"); }, []);
            const check = (uid) => window.dbGet(window.dbRef(window.db, 'users/'+uid)).then(s => { if(s.exists()){ setUser(s.val()); connect(s.val(), uid); } else window.dbGet(window.dbRef(window.db, 'pending_users/'+uid)).then(p => { if(p.exists()) setStatus("pending"); else { localStorage.removeItem("az_uid"); setStatus("auth"); }}) });
            const connect = (u, uid) => { const r = window.dbRef(window.db, 'lobby/'+uid); window.dbUpdate(r, { name:u.name, class:u.class, schoolName:u.schoolName, state:'waiting', uid }); window.dbOnDisconnect(r).remove(); setStatus("lobby"); };
            const login = (sid, no, pass) => { const uid = `${sid}_${no}`; window.dbGet(window.dbRef(window.db, 'users/'+uid)).then(s => { if(s.exists() && s.val().password === pass) { localStorage.setItem("az_uid", uid); setUser(s.val()); connect(s.val(), uid); } else alert("Hata!"); }); };
            const register = (data) => { const uid = `${data.schoolId}_${data.number}`; window.dbGet(window.dbRef(window.db, 'users/'+uid)).then(s => { if(s.exists()) alert("Kayƒ±tlƒ±!"); else { window.dbSet(window.dbRef(window.db, 'pending_users/'+uid), {...data, badges:[], stats:{wins:0}, joinedAt:Date.now()}); alert("Onay bekleniyor."); setStatus("auth"); } }); };
            const handleWin = async (type) => { 
                if(!user) return; const uid = `${user.schoolId}_${user.number}`; const ref = window.dbRef(window.db, 'users/'+uid); const s = await window.dbGet(ref); let u = s.val();
                u.stats.wins = (u.stats.wins||0)+1; let b = u.badges||[]; let won = null;
                if(!b.includes("first_win") && u.stats.wins>=1) { b.push("first_win"); won="first_win"; }
                if(!b.includes("mangala_master") && type==='mangala') { b.push("mangala_master"); won="mangala_master"; }
                u.badges = b; await window.dbUpdate(ref, u); setUser(u);
                if(won) { setBadge(BADGES[won]); setTimeout(()=>setBadge(null), 3000); }
            };
            useEffect(() => { if(status!=="lobby"||!user)return; const sub = window.dbOnValue(window.dbRef(window.db, 'lobby/'+`${user.schoolId}_${user.number}`), (s)=>{ const d=s.val(); if(d&&d.gameId){ setGameId(d.gameId); setRole(d.role); setStatus("playing"); } }); return ()=>sub(); }, [status, user]);

            if(status==="loading") return <div className="w-full h-full flex items-center justify-center"><i className="fas fa-circle-notch fa-spin text-4xl text-blue-500"></i></div>;
            if(status==="auth") return <div className="w-full h-full pc-container flex items-center justify-center"><AuthScreen onLogin={login} onRegister={register} /></div>;
            if(status==="pending") return <div className="w-full h-full flex flex-col items-center justify-center text-center"><i className="fas fa-clock text-4xl mb-4 text-slate-500 animate-pulse"></i><h2 className="text-xl font-bold">Onay Bekleniyor</h2><button onClick={()=>{localStorage.removeItem("az_uid"); setStatus("auth")}} className="mt-4 px-4 py-2 border border-white/10 rounded text-xs hover:bg-white/5">Geri</button></div>;
            
            return (
                <div className="w-full h-full flex items-center justify-center">
                    {badge && <div className="fixed inset-0 z-[200] flex items-center justify-center pointer-events-none"><div className="glass-box p-8 rounded-full text-center anim-pop"><div className="text-6xl mb-2">{badge.icon}</div><div className="text-xl font-bold text-yellow-400">{badge.name}</div></div></div>}
                    {prof && <ProfileModal user={user} onClose={()=>setProf(false)} onLogout={()=>{if(confirm("√áƒ±kƒ±≈ü?")){window.dbRemove(window.dbRef(window.db, 'lobby/'+`${user.schoolId}_${user.number}`)); localStorage.removeItem("az_uid"); setStatus("auth"); setProf(false);}}} />}
                    
                    {status==="lobby" && (
                        <div className="w-full h-full flex flex-col items-center justify-center text-center p-4 relative pc-container">
                            <button onClick={()=>setProf(true)} className="absolute top-6 right-6 flex items-center gap-2 bg-slate-800/80 px-4 py-2 rounded-full border border-white/10 hover:bg-slate-700 transition cursor-pointer z-50">
                                <i className="fas fa-user-astronaut text-blue-400"></i> <span className="text-xs font-bold text-white">{user.name.split(' ')[0]}</span>
                            </button>
                            <div className="glass-box p-10 rounded-3xl w-full max-w-md anim-pop relative overflow-hidden">
                                <div className="w-24 h-24 mx-auto bg-slate-900 rounded-full flex items-center justify-center text-5xl mb-6 shadow-inner border border-white/5 animate-pulse">üéÆ</div>
                                <h2 className="text-2xl font-bold mb-1 text-white">Rakip Aranƒ±yor...</h2>
                                <p className="text-slate-500 text-xs mb-8 tracking-wider">{user.schoolName}</p>
                                <div className="inline-flex items-center gap-3 px-6 py-2 bg-blue-500/10 text-blue-400 rounded-full border border-blue-500/20 text-[10px] font-bold tracking-widest"><span className="w-1.5 h-1.5 bg-blue-500 rounded-full animate-ping"></span> LOBƒ∞YE BAƒûLANDI</div>
                            </div>
                        </div>
                    )}

                    {status==="playing" && <GameShell gameId={gameId} playerRole={role} onWin={handleWin} onBack={()=>{setStatus("lobby"); setGameId(null); window.dbUpdate(window.dbRef(window.db, 'lobby/'+`${user.schoolId}_${user.number}`), {state:'waiting', gameId:null}); }} />}
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root')); root.render(<App />);
    </script>
</body>
</html>