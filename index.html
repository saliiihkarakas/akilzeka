<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>AkÄ±l Zeka OyunlarÄ± - Pro Arena</title>
    
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, update, onDisconnect, get, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyByVamD_83D1gNH9wMiR0jtQErasgq7Gss",
            authDomain: "turnuva-2418e.firebaseapp.com",
            databaseURL: "https://turnuva-2418e-default-rtdb.europe-west1.firebasedatabase.app/",
            projectId: "turnuva-2418e",
            storageBucket: "turnuva-2418e.firebasestorage.app",
            messagingSenderId: "299388405608",
            appId: "1:299388405608:web:e0985927f084bf803678dd"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        window.db = db; window.dbRef = ref; window.dbSet = set; window.dbOnValue = onValue; window.dbUpdate = update; window.dbOnDisconnect = onDisconnect; window.dbGet = get; window.dbRemove = remove;
    </script>

    <style>
        /* --- RESET & APP SHELL --- */
        html, body {
            width: 100%; height: 100%; margin: 0; padding: 0;
            overflow: hidden; 
            background-color: #030712; 
            color: white;
            font-family: 'Rajdhani', sans-serif;
            touch-action: none;
            -webkit-user-select: none; user-select: none;
        }

        /* --- BACKGROUND FX --- */
        .cyber-grid {
            position: fixed; top: 0; left: 0; width: 200vw; height: 200vh;
            background-image: linear-gradient(rgba(0, 255, 255, 0.03) 1px, transparent 1px),
            linear-gradient(90deg, rgba(0, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
            transform: perspective(500px) rotateX(60deg) translateY(-100px) translateZ(-200px);
            animation: gridMove 20s linear infinite;
            pointer-events: none; z-index: -1;
        }
        @keyframes gridMove { 0% { transform: perspective(500px) rotateX(60deg) translateY(0) translateZ(-200px); } 100% { transform: perspective(500px) rotateX(60deg) translateY(40px) translateZ(-200px); } }

        /* --- COMPONENT STYLES --- */
        .glass-panel {
            background: rgba(15, 23, 42, 0.75);
            backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        
        .pit-container {
            transition: transform 0.1s;
            background: rgba(2, 6, 23, 0.6);
            box-shadow: inset 0 0 15px rgba(0,0,0,1);
            border: 1px solid rgba(59, 130, 246, 0.1);
        }
        .pit-container:active { transform: scale(0.95); }
        .pit-active {
            border-color: #3b82f6;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.3), inset 0 0 10px rgba(59, 130, 246, 0.2);
            cursor: pointer;
        }

        .marble {
            border-radius: 50%;
            position: absolute;
            box-shadow: inset -1px -1px 2px rgba(0,0,0,0.8), inset 1px 1px 2px rgba(255,255,255,0.9), 0 0 5px rgba(255,255,255,0.2);
        }

        /* --- ANIMATIONS --- */
        @keyframes popIn { 0% { transform: scale(0); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .anim-pop { animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
    </style>
</head>
<body>
    <div class="cyber-grid"></div>
    <div id="root" class="w-full h-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const BADGES = { first_win: {icon:"â­",name:"Ä°lk Zafer"}, mangala_master: {icon:"ðŸ¦",name:"Mangala Kurdu"}, reversi_brain: {icon:"ðŸ§ ",name:"Strateji DehasÄ±"}, streak_fire: {icon:"ðŸ”¥",name:"Yenilmez"} };

        // --- GAME LOGIC ---
        function useMangalaGame(gameData, gameId, playerRole, onWin) {
            const moveStone = (pitIndex) => {
                if (gameData.winner) return;
                const isP1Turn = gameData.isP1Turn;
                const board = (gameData.board || []).map(n => parseInt(n, 10) || 0);

                if ((playerRole === 'P1' && !isP1Turn) || (playerRole === 'P2' && isP1Turn)) return;
                if (isP1Turn && (pitIndex < 0 || pitIndex > 5)) return;
                if (!isP1Turn && (pitIndex < 7 || pitIndex > 12)) return;
                if (board[pitIndex] === 0) return;

                let stones = board[pitIndex];
                let currentIndex = pitIndex;
                board[pitIndex] = 0; 

                if (stones === 1) {
                    currentIndex = (currentIndex + 1) % 14;
                    board[currentIndex] += 1;
                } else {
                    board[currentIndex] = 1; stones--; 
                    while (stones > 0) {
                        currentIndex = (currentIndex + 1) % 14;
                        if (isP1Turn && currentIndex === 13) continue;
                        if (!isP1Turn && currentIndex === 6) continue;
                        board[currentIndex] += 1; stones--;
                    }
                }
                const lastIndex = currentIndex;
                const p1Store = 6; const p2Store = 13;
                const isMyStore = isP1Turn ? lastIndex === p1Store : lastIndex === p2Store;
                const isOpponentSide = isP1Turn ? (lastIndex >= 7 && lastIndex <= 12) : (lastIndex >= 0 && lastIndex <= 5);
                const isMySide = isP1Turn ? (lastIndex >= 0 && lastIndex <= 5) : (lastIndex >= 7 && lastIndex <= 12);
                let nextTurnIsP1 = !isP1Turn;
                if (isMyStore) { nextTurnIsP1 = isP1Turn; }
                else if (isOpponentSide && board[lastIndex] % 2 === 0) {
                    const myStoreIndex = isP1Turn ? p1Store : p2Store;
                    board[myStoreIndex] += board[lastIndex]; board[lastIndex] = 0;
                }
                else if (isMySide && board[lastIndex] === 1) { 
                    const oppositeIndex = 12 - lastIndex;
                    if (board[oppositeIndex] > 0) {
                        const myStoreIndex = isP1Turn ? p1Store : p2Store;
                        board[myStoreIndex] += (board[lastIndex] + board[oppositeIndex]);
                        board[lastIndex] = 0; board[oppositeIndex] = 0;
                    }
                }
                const p1PitSum = board.slice(0, 6).reduce((a, b) => a + b, 0);
                const p2PitSum = board.slice(7, 13).reduce((a, b) => a + b, 0);
                let w = null;
                if (p1PitSum === 0 || p2PitSum === 0) {
                    if (p1PitSum === 0) { board[p1Store] += p2PitSum; for(let i=7; i<=12; i++) board[i] = 0; } 
                    else { board[p2Store] += p1PitSum; for(let i=0; i<=5; i++) board[i] = 0; }
                    if (board[p1Store] > board[p2Store]) w = gameData.players.p1.name;
                    else if (board[p2Store] > board[p1Store]) w = gameData.players.p2.name;
                    else w = "Berabere";
                    if(w && w !== "Berabere") { const wRole = w === gameData.players.p1.name ? 'P1' : 'P2'; if(wRole === playerRole) onWin('mangala'); }
                }
                window.dbUpdate(window.dbRef(window.db, 'games/' + gameId), { board: board, isP1Turn: nextTurnIsP1, winner: w });
            };
            return { moveStone };
        }

        function useReversiGame(gameData, gameId, playerRole, onWin) {
            const makeMove = (row, col) => {
                if (gameData.winner) return;
                const isP1Turn = gameData.isP1Turn; if ((playerRole === 'P1' && !isP1Turn) || (playerRole === 'P2' && isP1Turn)) return;
                const myColor = isP1Turn ? 1 : 2; const oppColor = isP1Turn ? 2 : 1; const board = gameData.board;
                if (board[row * 8 + col] !== 0) return;
                let flips = [];
                const directions = [[0,1], [1,0], [0,-1], [-1,0], [1,1], [1,-1], [-1,1], [-1,-1]];
                directions.forEach(([dr, dc]) => { let r = row + dr, c = col + dc; let potential = []; while (r>=0 && r<8 && c>=0 && c<8 && board[r*8+c] === oppColor) { potential.push(r*8+c); r += dr; c += dc; } if (potential.length > 0 && r>=0 && r<8 && c>=0 && c<8 && board[r*8+c] === myColor) flips.push(...potential); });
                if (flips.length === 0) return;
                let newBoard = [...board]; newBoard[row * 8 + col] = myColor;
                flips.forEach(idx => newBoard[idx] = myColor);
                let w = null; if (!newBoard.includes(0)) { const p1c = newBoard.filter(x => x === 1).length;
                const p2c = newBoard.filter(x => x === 2).length; w = p1c > p2c ?
                gameData.players.p1.name : (p2c > p1c ? gameData.players.p2.name : "Berabere"); if(w && w !== "Berabere") { const wRole = w === gameData.players.p1.name ?
                'P1' : 'P2'; if(wRole === playerRole) onWin('reversi'); } }
                window.dbUpdate(window.dbRef(window.db, 'games/' + gameId), { board: newBoard, isP1Turn: !isP1Turn, winner: w });
            };
            return { makeMove };
        }

        // --- ULTRA RESPONSIVE SCALER (Fixed Landscape Issue) ---
        const FitScreen = ({ children }) => {
            const [scale, setScale] = useState(1);
            const containerRef = useRef(null);

            useEffect(() => {
                const resize = () => {
                    const w = window.innerWidth;
                    const h = window.innerHeight;
                    const isLandscape = w > h;
                    
                    // MOBIL MANZARA MODU (Landscape) OPTÄ°MÄ°ZASYONU
                    // EkranÄ± olabildiÄŸince doldurmak iÃ§in hedef boyutlarÄ± kÃ¼Ã§Ã¼ltÃ¼yoruz
                    // BÃ¶ylece scale oranÄ± (Ekran / Hedef) artÄ±yor ve oyun bÃ¼yÃ¼yor.
                    
                    let targetW = 900;
                    let targetH = 500;

                    let safeW = w - 20; // Default padding
                    let safeH = h - 80; // Default header payÄ±

                    if (isLandscape && h < 500) { 
                        // Telefonu yan Ã§evirdiysen
                        safeH = h - 20; // Header'Ä± yok say veya Ã¼stÃ¼ne bin
                        targetH = 450; // Hedef yÃ¼ksekliÄŸi kÄ±s
                        targetW = 850; // Hedef geniÅŸliÄŸi kÄ±s
                    }

                    const scaleX = safeW / targetW;
                    const scaleY = safeH / targetH;
                    
                    let s = Math.min(scaleX, scaleY);
                    if(s > 1.3) s = 1.3; // PC'de aÅŸÄ±rÄ± bÃ¼yÃ¼meyi engelle
                    
                    setScale(s);
                };
                window.addEventListener('resize', resize);
                resize();
                return () => window.removeEventListener('resize', resize);
            }, []);

            return (
                <div className="flex-1 flex items-center justify-center relative w-full h-full overflow-hidden">
                    <div ref={containerRef} style={{
                        width: '900px', // Base width
                        height: '500px', // Base height
                        transform: `scale(${scale})`,
                        transformOrigin: 'center center',
                        transition: 'transform 0.2s',
                        display: 'flex', alignItems: 'center', justifyContent: 'center'
                    }}>
                        {children}
                    </div>
                </div>
            );
        };

        // --- COMPONENTS ---
        const MangalaBoard = ({ game, playerRole, onMove }) => {
            const board = (game.board || []).map(n => parseInt(n, 10) || 0);
            const isMyTurn = (playerRole === 'P1' && game.isP1Turn) || (playerRole === 'P2' && !game.isP1Turn);

            const Pit = ({ c, owner, store, act, active }) => {
                const count = Math.max(0, c || 0);
                const marbles = [...Array(Math.min(count, 30))].map((_, i) => {
                    const seed = (i * 137.5) % 360; const dist = Math.sqrt(i) * 5; 
                    const x = Math.cos(seed * Math.PI / 180) * dist;
                    const y = Math.sin(seed * Math.PI / 180) * dist;
                    const color = owner==='me' ? 'bg-amber-400' : 'bg-cyan-400';
                    return <div key={i} className={`w-3 h-3 marble ${color}`} style={{left:`calc(50% + ${x}px - 6px)`, top:`calc(50% + ${y}px - 6px)`}}></div>
                });

                return (
                    <div onClick={act} className={`relative flex items-center justify-center pit-container 
                        ${store ? 'w-24 h-48 rounded-2xl' : 'w-20 h-20 rounded-full'}
                        ${active ? 'pit-active' : 'opacity-80'}
                    `}>
                        {marbles}
                        {count > 30 && <div className="absolute bg-black/60 text-white text-xs rounded px-1 font-bold z-10">+{count-30}</div>}
                        <div className={`absolute -bottom-3 px-2 py-0.5 rounded-md text-xs font-bold border ${active?'bg-blue-600 border-blue-400':'bg-slate-800 border-slate-600'}`}>{count}</div>
                    </div>
                );
            };

            return (
                <div className="bg-slate-900/80 p-6 rounded-[2rem] border-2 border-slate-700 shadow-2xl flex gap-6 items-center backdrop-blur-md relative w-full h-full justify-between">
                    <div className="flex flex-col items-center gap-2">
                        <div className="text-[10px] bg-slate-800 px-2 rounded text-slate-400 border border-slate-700">RAKÄ°P</div>
                        <Pit c={playerRole==='P1'?board[13]:board[6]} owner="opponent" store={true} />
                    </div>
                    <div className="flex flex-col gap-4">
                        <div className="flex gap-2 p-2 bg-slate-950/50 rounded-xl border border-white/5">
                            {[5,4,3,2,1,0].map(i => { const idx = playerRole==='P1' ? (12-i) : (5-i); return <Pit key={idx} c={board[idx]} owner="opponent"/> })}
                        </div>
                        <div className={`flex gap-2 p-2 rounded-xl border transition-colors ${isMyTurn?'bg-blue-900/20 border-blue-500/30':'bg-slate-950/50 border-white/5'}`}>
                            {[0,1,2,3,4,5].map(i => { const idx = playerRole==='P1' ? i : (i+7); return <Pit key={idx} c={board[idx]} owner="me" active={isMyTurn} act={()=>isMyTurn && onMove(idx)}/> })}
                        </div>
                    </div>
                    <div className="flex flex-col items-center gap-2">
                        <div className="text-[10px] bg-amber-900/30 px-2 rounded text-amber-500 border border-amber-500/30">SEN</div>
                        <Pit c={playerRole==='P1'?board[6]:board[13]} owner="me" store={true} />
                    </div>
                </div>
            );
        };

        const ReversiBoard = ({ game, playerRole, onMove }) => {
            const board = (game.board || []).map(n => parseInt(n, 10) || 0);
            const isMyTurn = (playerRole === 'P1' && game.isP1Turn) || (playerRole === 'P2' && !game.isP1Turn); 
            const black = board.filter(x=>x===1).length; const white = board.filter(x=>x===2).length;
            
            return (
                <div className="flex gap-8 items-center justify-center h-full">
                    <div className="flex flex-col gap-4">
                        <div className="bg-slate-800 p-4 rounded-xl border border-slate-700 w-32 text-center shadow-lg"><div className="w-8 h-8 bg-black rounded-full mx-auto border border-gray-600 mb-2"></div><div className="text-3xl font-bold">{black}</div></div>
                        <div className="bg-slate-200 text-black p-4 rounded-xl border border-slate-400 w-32 text-center shadow-lg"><div className="w-8 h-8 bg-white rounded-full mx-auto border border-gray-300 mb-2"></div><div className="text-3xl font-bold">{white}</div></div>
                    </div>
                    <div className="bg-green-800 p-3 rounded-lg shadow-2xl border-[6px] border-green-900">
                        <div className="grid grid-cols-8 gap-1">
                            {board.map((cell, i) => (
                                <div key={i} onClick={() => isMyTurn && onMove(Math.floor(i/8), i%8)} className="w-10 h-10 bg-green-600 hover:bg-green-500 cursor-pointer flex items-center justify-center rounded-sm">
                                    {cell !== 0 && <div className={`w-[80%] h-[80%] rounded-full shadow-lg transition-transform duration-300 hover:scale-105 ${cell===1?'bg-black border border-gray-700':'bg-white border border-gray-300'}`}></div>}
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const AuthScreen = ({ onLogin, onRegister }) => {
            const [mode, setMode] = useState("login");
            const [schools, setSchools] = useState([]); const [schoolId, setSchoolId] = useState(""); const [number, setNumber] = useState(""); const [password, setPassword] = useState(""); const [name, setName] = useState(""); const [cls, setCls] = useState("");
            useEffect(() => { if(window.dbRef) window.dbOnValue(window.dbRef(window.db, 'schools'), (snap) => { const val = snap.val(); if(val) setSchools(Object.values(val)); }); }, []);
            const doAuth = () => {
                if(!schoolId || !number || !password) return alert("Eksik bilgi!");
                if(mode === "login") onLogin(schoolId, number, password);
                else { if(!name || !cls) return alert("Ad ve SÄ±nÄ±f giriniz!"); const selectedSchool = schools.find(s => s.id === schoolId); onRegister({ schoolId, schoolName: selectedSchool.name, number, password, name, class: cls }); }
            };
            return (
                <div className="flex h-full items-center justify-center p-4 overflow-y-auto">
                    <div className="glass-panel p-8 rounded-2xl w-full max-w-sm anim-pop relative overflow-hidden">
                        <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 to-purple-500"></div>
                        <div className="text-center mb-8">
                            <h1 className="text-4xl font-bold tracking-widest text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-300">AKIL OYUNLARI</h1>
                            <p className="text-slate-400 text-xs tracking-widest mt-2 uppercase">Online Turnuva Platformu</p>
                        </div>
                        <div className="space-y-4">
                            <div className="bg-slate-900/50 rounded-lg p-3 border border-slate-700/50">
                                <label className="text-[10px] text-blue-400 font-bold block mb-1">OKUL</label>
                                <select value={schoolId} onChange={e=>setSchoolId(e.target.value)} className="w-full bg-transparent outline-none text-sm font-bold text-slate-300"><option value="">SeÃ§im YapÄ±nÄ±z</option>{schools.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}</select>
                            </div>
                            {mode==="register" && <div className="grid grid-cols-2 gap-2"><input placeholder="Ad Soyad" value={name} onChange={e=>setName(e.target.value)} className="bg-slate-900/50 p-3 rounded-lg border border-slate-700/50 outline-none text-sm text-white" /><input placeholder="SÄ±nÄ±f" value={cls} onChange={e=>setCls(e.target.value)} className="bg-slate-900/50 p-3 rounded-lg border border-slate-700/50 outline-none text-sm text-white" /></div>}
                            <div className="grid grid-cols-2 gap-2">
                                <input placeholder="Numara" value={number} onChange={e=>setNumber(e.target.value)} className="bg-slate-900/50 p-3 rounded-lg border border-slate-700/50 outline-none text-sm text-center text-white" />
                                <input type="password" placeholder="Åžifre" value={password} onChange={e=>setPassword(e.target.value)} className="bg-slate-900/50 p-3 rounded-lg border border-slate-700/50 outline-none text-sm text-center text-white" />
                            </div>
                            <button onClick={doAuth} className="w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg font-bold text-sm tracking-wide hover:brightness-110 shadow-lg shadow-blue-900/50 transition-all text-white">{mode==="login"?"GÄ°RÄ°Åž YAP":"KAYDI TAMAMLA"}</button>
                            <button onClick={()=>setMode(mode==="login"?"register":"login")} className="w-full text-xs text-slate-500 hover:text-white transition"> {mode==="login"?"HesabÄ±n yok mu? KayÄ±t Ol":"GiriÅŸ EkranÄ±na DÃ¶n"} </button>
                        </div>
                    </div>
                </div>
            );
        };

        const LobbyScreen = ({ user, onProfile }) => (
            <div className="h-full flex flex-col items-center justify-center text-center p-4">
                <button onClick={onProfile} className="absolute top-4 right-4 flex items-center gap-2 bg-slate-800/50 px-3 py-1 rounded-full border border-slate-700 hover:bg-slate-700 transition z-50 cursor-pointer">
                    <i className="fas fa-user-astronaut text-blue-400"></i> <span className="text-xs font-bold text-white">{user.name.split(' ')[0]}</span>
                </button>
                <div className="glass-panel p-10 rounded-3xl w-full max-w-md anim-pop relative">
                    <div className="w-24 h-24 mx-auto bg-slate-900 rounded-full flex items-center justify-center text-5xl mb-6 shadow-[0_0_20px_rgba(59,130,246,0.3)] animate-pulse border border-blue-500/30">ðŸŽ®</div>
                    <h2 className="text-2xl font-bold mb-2 text-white">Rakip AranÄ±yor...</h2>
                    <p className="text-slate-400 text-sm mb-8">{user.schoolName}</p>
                    <div className="inline-flex items-center gap-3 px-6 py-2 bg-blue-500/10 text-blue-400 rounded-full border border-blue-500/20 text-xs font-bold"><span className="w-2 h-2 bg-blue-500 rounded-full animate-ping"></span> LOBÄ°YE BAÄžLANDI</div>
                </div>
            </div>
        );

        const GameContainer = ({ gameId, playerRole, onBack, onWin }) => {
            const [gameData, setGameData] = useState(null);
            useEffect(() => { const sub = window.dbOnValue(window.dbRef(window.db, 'games/' + gameId), (s) => setGameData(s.val())); return () => sub(); }, [gameId]);
            if (!gameData) return <div className="h-full flex items-center justify-center"><i className="fas fa-spinner fa-spin text-4xl text-blue-500"></i></div>;
            
            return (
                <div className="w-full h-full flex flex-col">
                    <div className="h-14 flex items-center justify-between px-4 bg-slate-900/80 border-b border-slate-800 backdrop-blur z-20">
                        <div className="text-[10px] font-bold text-slate-500 tracking-widest border border-slate-700 px-2 py-1 rounded">ODA: {gameId}</div>
                        {gameData.winner ? 
                             <div className="px-4 py-1 bg-amber-500/20 text-amber-500 border border-amber-500/50 rounded text-xs font-bold animate-pulse">KAZANAN: {gameData.winner}</div>
                            : <div className={`px-4 py-1 rounded text-xs font-bold border ${((playerRole==='P1' && gameData.isP1Turn)||(playerRole==='P2' && !gameData.isP1Turn)) ? 'bg-green-500/20 text-green-400 border-green-500/50' : 'bg-slate-800 text-slate-500 border-slate-700'}`}>
                                {((playerRole==='P1' && gameData.isP1Turn)||(playerRole==='P2' && !gameData.isP1Turn)) ? "SIRA SENDE" : "RAKÄ°P BEKLENÄ°YOR"}
                            </div>
                        }
                        <button onClick={onBack} className="text-red-500 hover:bg-red-500/10 px-3 py-1 rounded transition"><i className="fas fa-power-off"></i></button>
                    </div>
                    <div className="flex-1 relative bg-slate-950/50 overflow-hidden">
                        <FitScreen>
                            {gameData.type === 'reversi' ? 
                                <ReversiBoard game={gameData} playerRole={playerRole} onMove={useReversiGame(gameData, gameId, playerRole, onWin).makeMove} /> : 
                                <MangalaBoard game={gameData} playerRole={playerRole} onMove={useMangalaGame(gameData, gameId, playerRole, onWin).moveStone} />
                            }
                        </FitScreen>
                    </div>
                </div>
            );
        };

        const ProfileModal = ({ user, onClose, onLogout }) => (
            <div className="fixed inset-0 bg-black/80 backdrop-blur flex items-center justify-center z-[100]" onClick={onClose}>
                <div className="glass-panel w-full max-w-sm rounded-2xl overflow-hidden anim-pop" onClick={e=>e.stopPropagation()}>
                    <div className="p-6 text-center border-b border-slate-700">
                        <div className="w-20 h-20 mx-auto bg-gradient-to-tr from-blue-600 to-purple-600 rounded-2xl flex items-center justify-center text-3xl mb-4 shadow-lg text-white font-bold">{user.name.charAt(0)}</div>
                        <h2 className="text-xl font-bold text-white">{user.name}</h2>
                        <p className="text-slate-400 text-sm">{user.schoolName} - {user.class}</p>
                    </div>
                    <div className="p-4 grid grid-cols-2 gap-3 text-center">
                        <div className="bg-slate-900 p-3 rounded-xl border border-slate-800"><div className="text-2xl font-bold text-blue-400">{user.stats?.wins||0}</div><div className="text-[10px] text-slate-500">ZAFER</div></div>
                        <div className="bg-slate-900 p-3 rounded-xl border border-slate-800"><div className="text-2xl font-bold text-amber-400">{(user.badges||[]).length}</div><div className="text-[10px] text-slate-500">ROZET</div></div>
                    </div>
                    <div className="p-4 bg-slate-950/50 max-h-[150px] overflow-auto">
                        <div className="text-[10px] text-slate-500 font-bold mb-2 uppercase tracking-wider text-left">ROZETLERÄ°M</div>
                        <div className="grid grid-cols-1 gap-2">
                             {Object.entries(BADGES).map(([key, data]) => { 
                                const hasBadge = (user.badges || []).includes(key); 
                                return (
                                    <div key={key} className={`flex items-center gap-3 p-2 rounded-lg border ${hasBadge ? 'bg-slate-800 border-blue-500/30' : 'opacity-30 border-transparent'}`}>
                                        <div className="text-xl">{data.icon}</div>
                                        <div className="text-left"><div className="text-xs font-bold text-slate-200">{data.name}</div>{hasBadge && <div className="text-[9px] text-green-400">KAZANILDI</div>}</div>
                                    </div>
                                ); 
                            })}
                        </div>
                    </div>
                    <button onClick={onLogout} className="w-full py-4 bg-red-900/20 text-red-500 font-bold text-xs hover:bg-red-900/40 transition">Ã‡IKIÅž YAP</button>
                </div>
            </div>
        );

        const App = () => {
            const [user, setUser] = useState(null); const [status, setStatus] = useState("loading"); const [gameId, setGameId] = useState(null); const [role, setRole] = useState(null); const [prof, setProf] = useState(false); const [badge, setBadge] = useState(null);
            
            useEffect(() => { const uid = localStorage.getItem("az_uid"); if(uid) checkUser(uid); else setStatus("auth"); }, []);
            const checkUser = (uid) => window.dbGet(window.dbRef(window.db, 'users/'+uid)).then(s => { if(s.exists()){ setUser(s.val()); connect(s.val(), uid); } else window.dbGet(window.dbRef(window.db, 'pending_users/'+uid)).then(p => { if(p.exists()) setStatus("pending"); else { localStorage.removeItem("az_uid"); setStatus("auth"); }}) });
            const connect = (u, uid) => { const r = window.dbRef(window.db, 'lobby/'+uid); window.dbUpdate(r, { name:u.name, class:u.class, schoolName:u.schoolName, state:'waiting', uid }); window.dbOnDisconnect(r).remove(); setStatus("lobby"); };
            const login = (sid, no, pass) => { const uid = `${sid}_${no}`; window.dbGet(window.dbRef(window.db, 'users/'+uid)).then(s => { if(s.exists() && s.val().password === pass) { localStorage.setItem("az_uid", uid); setUser(s.val()); connect(s.val(), uid); } else alert("Hata!"); }); };
            const register = (data) => { const uid = `${data.schoolId}_${data.number}`; window.dbGet(window.dbRef(window.db, 'users/'+uid)).then(s => { if(s.exists()) alert("KayÄ±tlÄ±!"); else { window.dbSet(window.dbRef(window.db, 'pending_users/'+uid), {...data, badges:[], stats:{wins:0}, joinedAt:Date.now()}); alert("Onay bekleniyor."); setStatus("auth"); } }); };
            const handleWin = async (type) => { 
                if(!user) return; const uid = `${user.schoolId}_${user.number}`; const ref = window.dbRef(window.db, 'users/'+uid); const s = await window.dbGet(ref); let u = s.val();
                u.stats.wins = (u.stats.wins||0)+1; let b = u.badges||[]; let won = null;
                if(!b.includes("first_win") && u.stats.wins>=1) { b.push("first_win"); won="first_win"; }
                if(!b.includes("mangala_master") && type==='mangala') { b.push("mangala_master"); won="mangala_master"; }
                u.badges = b; await window.dbUpdate(ref, u); setUser(u);
                if(won) { setBadge(BADGES[won]); setTimeout(()=>setBadge(null), 3000); }
            };
            useEffect(() => { if(status!=="lobby"||!user)return; const sub = window.dbOnValue(window.dbRef(window.db, 'lobby/'+`${user.schoolId}_${user.number}`), (s)=>{ const d=s.val(); if(d&&d.gameId){ setGameId(d.gameId); setRole(d.role); setStatus("playing"); } }); return ()=>sub(); }, [status, user]);

            if(status==="loading") return <div className="h-full flex items-center justify-center"><i className="fas fa-circle-notch fa-spin text-4xl text-blue-500"></i></div>;
            if(status==="auth") return <AuthScreen onLogin={login} onRegister={register} />;
            if(status==="pending") return <div className="h-full flex flex-col items-center justify-center text-center"><i className="fas fa-hourglass-half text-4xl mb-4 animate-pulse"></i><h2 className="text-xl font-bold">Onay Bekleniyor</h2><button onClick={()=>{localStorage.removeItem("az_uid"); setStatus("auth")}} className="mt-4 px-4 py-2 bg-slate-800 rounded border border-slate-700 text-xs text-white">Geri</button></div>;
            
            return (
                <div className="h-full w-full">
                    {badge && <div className="fixed inset-0 z-[200] flex items-center justify-center pointer-events-none"><div className="glass-panel p-8 rounded-full text-center anim-pop"><div className="text-6xl mb-2">{badge.icon}</div><div className="text-xl font-bold text-yellow-400">{badge.name}</div></div></div>}
                    {prof && <ProfileModal user={user} onClose={()=>setProf(false)} onLogout={()=>{if(confirm("Ã‡Ä±kÄ±ÅŸ?")){window.dbRemove(window.dbRef(window.db, 'lobby/'+`${user.schoolId}_${user.number}`)); localStorage.removeItem("az_uid"); setStatus("auth"); setProf(false);}}} />}
                    {status==="lobby" && <LobbyScreen user={user} onProfile={()=>setProf(true)} />}
                    {status==="playing" && <GameContainer gameId={gameId} playerRole={role} onWin={handleWin} onBack={()=>{setStatus("lobby"); setGameId(null); window.dbUpdate(window.dbRef(window.db, 'lobby/'+`${user.schoolId}_${user.number}`), {state:'waiting', gameId:null}); }} />}
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root')); root.render(<App />);
    </script>
</body>
</html>